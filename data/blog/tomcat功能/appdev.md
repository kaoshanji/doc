#   部署项目

##  部署

### 背景

Servlet API 2.2(或更高版本)规范要求Web容器有规范的目录文件组织格式

Web应用程序被定义为固定的目录和文件层次结构，这种层次结构可以以其"解包"形式访问，其中每个目录和文件分别存在于文件系统中，或者以`WAR`文件的'打包'形式存在。

Web应用程序层次结构的根目录也是应用程序的根目录，文件根目录是`catalog`，那么请求URI是：`http://ip:port/catalog`

### 标准目录结构

为了便于以所需格式创建Web应用程序存档文件，可以方便地在同一组织中安排Web应用程序的“可执行”文件（即Tomcat在执行应用程序时实际使用的文件）。WAR格式文件有以下内容：
-   `*.html`，`*.jsp`等 - HTML和JSP页面，以及应用程序必须对客户端浏览器可见的其他文件（如JavaScript，样式表文件和图像）。在较大的应用程序中，您可以选择将这些文件划分为子目录层次结构，但对于较小的应用程序，为这些文件仅维护一个目录通常要简单得多
-   `/WEB-INF/web.xml` - 应用程序的Web应用程序部署描述符。这是一个XML文件，描述构成应用程序的servlet和其他组件，以及您希望服务器为您强制执行的任何初始化参数和容器管理的安全性约束
-   `/WEB-INF/classes/` - 此目录包含应用程序所需的任何Java类文件（和相关资源），包括servlet和非servlet类，它们未组合到JAR文件中。例如，名为的Java类 `com.mycompany.mypackage.MyServlet` 需要存储在名为的文件中`/WEB-INF/classes/com/mycompany/mypackage/MyServlet.class`。
-   `/WEB-INF/lib/` - 此目录包含JAR文件，这些文件包含应用程序所需的Java类文件（和相关资源），例如第三方类库或JDBC驱动程序。

将应用程序安装到Tomcat时，`WEB-INF/classes/` 目录中的类以及`WEB-INF/lib/`目录中找到的JAR文件中的所有类对特定Web应用程序中的其他类可见。

### 共享库文件

Tomcat安装中常用于共享代码的位置是 `$CATALINA_HOME/lib`，放置在此处的JAR文件对Web应用程序和内部Tomcat代码都可见。

### Web应用程序部署描述符

`/WEB-INF/web.xml`文件包含应用程序的Web应用程序部署描述符，它定义了服务器需要知道的有关应用程序的所有内容。

为了提供一个起点，提供了一个[基本的web.xml文件](http://tomcat.apache.org/tomcat-9.0-doc/appdev/web.xml.txt)，此文件包含描述每个包含元素的用途的注释。

### Tomcat上下文描述符

`/META-INF/context.xml`文件可用于定义Tomcat特定的配置选项，例如访问日志，数据源，会话管理器配置等。此XML文件必须包含一个Context元素，该元素将被视为它是与要部署Web应用程序的Host对应的Host元素的子元素。[Tomcat配置文件](http://tomcat.apache.org/tomcat-9.0-doc/config/context.html)包含上下文元素上的信息。

### 使用Tomcat进行部署

为了执行，必须在servlet容器上部署Web应用程序。即使在开发过程中也是如此。我们将描述使用Tomcat来提供执行环境。可以通过以下方法之一在Tomcat中部署Web应用程序：

-   将解压缩的目录层次结构复制到目录中的子目录中`../webapps/`，Tomcat将根据您选择的子目录名称为您的应用程序分配上下文路径。
-   将Web应用程序归档文件`WAR`复制到目录中`../webapps/`。当Tomcat启动时，它会自动将Web应用程序归档文件扩展为其解压缩的形式，并以这种方式执行应用程序。此方法通常用于将第三方供应商或内部开发人员提供的其他应用程序安装到现有Tomcat安装中。

----

##  源代码

### 目录结构

代码管理工具：Ant

组件都存在于应用程序的顶级项目源目录下：
-   `docs/` - 您的应用程序的文档，无论您的开发团队使用何种格式
-   `src/` - 生成servlet，bean和应用程序特有的其他Java类的Java源文件。如果源代码是在程序包中组织的（强烈 推荐），则程序包层次结构应反映为此目录下的目录结构
-   `web/` - 应用程序客户端可访问的Web站点的静态内容（HTML页面，JSP页面，JavaScript文件，CSS样式表文件和图像）。此目录将是Web应用程序的 文档根目录，此处的任何子目录结构都将反映在访问这些文件所需的请求URI中。
-   `web/WEB-INF/` - 应用程序所需的特殊配置文件，包括Web应用程序部署描述符，您创建的自定义标记库的标记库描述符以及您希望包含的其他资源文件在您的Web应用程序中。即使此目录似乎是文档根目录的子目录，Servlet规范禁止直接向客户端请求提供此目录（或其包含的任何文件）的内容。因此，这是存储敏感配置信息（例如数据库连接用户名和密码）的好地方，但是应用程序成功运行是必需的。

在开发过程中，将临时创建另外两个目录：
-   `dist/` - 执行`ant dist` 目标时，将创建此目录。它将为您的Web应用程序创建二进制分发的映像，包括您准备的许可证信息，文档和自述文件。
-   `build/` - 执行默认build（ant）时，此目录将包含此应用程序的Web应用程序归档中文件的映像

请注意，这两个目录应该不要在你的源代码控制系统的开发过程中需要存档，因为它们删除并重新创建（从零开始）

----

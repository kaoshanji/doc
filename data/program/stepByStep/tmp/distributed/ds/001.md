#   基础

##  分布式系统地特征

分布式系统是其组件分别在连网的计算机上，组件之间通过传递消息进行通信和动作协调的系统，重要特征：组件的并发性、缺乏全局时钟、组件故障的独立性。

资源共享是构造分布式系统地主要动机，资源可以被服务器管理，由客户访问，或者他们被封装成对象，由其他客户对象访问。

### 简介

把分布式系统定义成一个其硬件或软件组件分布在联网的计算机上，组件之间通过传递消息进行通信和动作协调的系统。

显著特征：
-   并发
-   缺乏全局时钟
-   故障独立性

构造和使用分布式系统地主要动力来源于对共享资源的期望。"资源"一词是相当抽象的，但他很好的描述了能在连网的计算机系统中共享的事物的范围。

### 分布式系统的例子

-   Web搜索
-   大型多人在线游戏
-   金融交易

### 分布式系统的趋势

-   泛在联网和现代互联网
-   移动和无处不在计算
-   分布式多媒体系统
-   把分布式计算作为一个公共设施

### 关注资源共享

大家通常共享硬件资源、数据资源和具有特定功能的资源

### 挑战

-   异构性：大量异构计算机和网络上访问服务和运行应用程序
-   开发性：新的资源共享服务能被增加和供多种客户程序使用的程度
-   安全性：机密性、完整性、可用性
-   可伸缩性：可在不同的规模下有效且高效的运转
-   故障处理：有些组件出了故障而有些组件运行正常
-   并发性：服务和应用通常允许并发地处理多个客户请求。
-   透明性：对用户和应用程序员屏蔽分布式系统地组件的分离性，使系统被认为是一个整体
-   服务质量：服务质量是可靠性、安全性和性能

### 实例研究：万维网

万维网是一个不断发展的系统，用于发布和访问互联网上的资源和服务。

##  系统模型

-   物理模型：考虑组成系统的计算机和设备的类型以及他们的互连。

最小物理模型是一组可扩展的计算机节点，这些节点通过计算机网络相互连接进行所需的消息传递。

-   体系结构模型：从系统的计算元素执行的计算和通信任务方面来描述系统。

独立指定的组件以及这些组件之间的关系来表示的结构。整体目标是确保结构能满足现在和将来可能的需求，主要关心的是系统可靠性、可管理性、适应性和性价比。

-   基础模型：采用抽象的观点描述大多数分布式系统面临的单个问题的解决方案。

交互：计算在进程中发生，进程通过传递消息交互，并引发进程之间的通信(信息流)和协调(活动的同步和排序)

故障：只要分布式系统运行的任一计算机上出现故障(包括软件故障)或连接他们的网络出现故障，分布式系统地正确操作就会受到威胁

安全：分布式系统地模块特征和开放性将其暴露在外部代理和内部代理的攻击下。

### 简介

三个重要方面的基础模型：交互模型，他考虑在系统元素之间通信的结构和顺序；故障模型，他考虑一个系统可能不能正确操作的方式；安全模型，他考虑如何保护系统使其不受到正确操作的干扰或不被窃取数据。

### 物理模型

物理模型是从计算机和所用网络技术的特定细节中抽象出来的分布式系统底层硬件元素的表示。

### 体系结构模型

一个系统地体系结构是用独立指定的组件以及这些组件之间的关系来表示的结构。整体目标是确保结构能满足现在和将来可能的需求，主要关心的是系统可靠性、可管理性、适应性和性价比。

-   分布式系统地核心基本体系结构元素
-   分布式系统解决方案中单独使用或组合使用的复合体系结构模式
-   体系结构风格中出现的不同编程风格

### 基础模型

所有的模型都共享下列设计需求：实现进程及网络的性能和可靠性特征，确保系统中资源的安全性，

-   交互模型
    -   通信通道的性能
    -   计算机时钟和时序事件
    -   交互模型的两个变体
    -   事件排序
-   故障模型
    -   遗漏故障
    -   随机故障
    -   时序故障
    -   故障屏蔽
    -   一对一通信的可靠性
-   安全模型
    -   保护对象
    -   保护进程和他们的交互
    -   敌人
    -   解除安全威胁
    -   安全模式的使用

##  网络和网际互联

分布式系统使用局域网、广域网和互联网络进行通信，为适应用户需求的改变，无线网络和有服务质量保障的高性能网络应运而生。

计算机网络所基于的原理包括协议分层、包交换、路由以及数据流等，网际互联技术使得异构网络可以集成在一起。 

### 简介

-   通信子系统：分布式系统提供通信设施的软硬件组件

传输介质：电线、电缆、光纤以及无线频道

硬件设备：路由器、交换机、网桥、集线器、转发器和网络接口

软件组件：协议栈、通信处理器和驱动器

-   主机：计算机和其他使用网络进行通信的设备

-   结点：在网络上的所有计算机或交换设备  

### 网络类型

支持分布式系统地网络类型：个域网、局域网、广域网、城域网以及无线变体。

### 网络原理

计算机网络的基础是包交换技术，他使得发送到多个地址的消息可以共享同一条通信链接。当链接可用时，数据包按顺序排列在缓冲区，然后发送。

-   数据包的传输
-   数据流
-   交换模式
    -   广播
    -   电路交换
    -   包交换
    -   帧中继
-   协议
    -   协议层
    -   协议组
    -   数据包组装
    -   端口
    -   寻址
    -   数据包传递
    -   虚电路包传递
-   路由
-   拥塞控制
-   网际互联
    -   路由器
    -   网桥
    -   集线器
    -   交换机
    -   隧道

### 互联网协议

介绍TCP/IP协议组。

-   IP寻址
-   IP协议
-   IP路由
-   IPv6
-   移动IP
-   TCP/UDP
-   域名
-   防火墙

### 实例研究：以太网、WiFi、蓝牙

以太网：为个人工作站和分布式系统开发出来的

WiFi：WiFi标准扩展了以太网技术采用的载波侦听多路复用原理以适应无线通信的特征

蓝牙：一种无线个域网技术，源于通过无线连接移动电话与PDA、笔记本电脑以及其他个人设备的需求

##  进程间通信

用户互联网中进程间通信的Java API提供数据报和流通信。

分布式应用需要组播。

### 简介

UDP 的应用程序接口提供了消息传递抽象--进程间通信的最简单形式

TCP 的应用程序结构提供了进程对之间的双向流抽象。相互通信的信息由没有消息边界的一连串数据项组成。

### 互联网协议的API

讨论进程间通信的普遍特征。

-   进程间通信的特征
    -   同步和异步通信
    -   消息目的地
    -   可靠性
    -   排序
-   套接字
    
两种形式的通信(UDP和TCP)都使用套接字抽象，套接字提供进程间通信的一个端点。

-   UDP数据报通信
    -   消息大小
    -   阻塞
    -   超时
    -   任意接收
-   TCP流通信

### 外部数据表示和编码

存储在运行的程序中的信息都表示成数据结构，如相互关联的对象集合，而消息中的消息由字节序列组成。

-   CORBA的公共数据表示
-   Java对象序列化
-   可扩展标记语言
-   远程对象引用

### 组播通信

一个进程与一组进程通信可能是必要的。

-   IP组播---组播通信的实现
    -   IP组播
    -   组播数据报的故障模型
    -   IP组播的Java API
-   组播的可靠性和排序

### 网络虚拟化：覆盖网络

互联网通信协议的强大在于他们通过API提供了一组有效的构造分布式软件的构造块，但是，不断增加的大量不同类型的应用在互联网上并存。

-   覆盖网络：一个结点和虚拟链接组成的虚拟网络，他位于一个底层网络之上
-   Skype：一个覆盖网络的例子

### 实例研究：消息传递接口(MPI)


##  远程调用

介绍远程调用泛型。

-   远程过程调用(RPC)：将过程调用的通用编程抽象扩展到分布式环境。一个调用过程可以像调用本地结点上的过程那样去调用一个远程结点上的过程
-   远程方法调用(RMI)：与RPC类似

### 简介

在分布式系统中进程(或者是抽象层次比较高的实体、如对象和服务)如何通信。

远程调用范型：
-   请求 - 应答协议描述了一个基于消息传递的范型，该协议支持在客户端、服务器计算中遇到的消息双向传输。
-   远程过程调用模型允许客户程序透明的调用在服务器程序中的过程，而这些服务器程序运行在不同的进程中，通常位于不同于客户端的计算机中
-   RMI是对本地方法调用的扩展，允许一个进程对象调用另一个进程对象的方法

### 请求-应答协议

这种通信设计用于支持典型客户/服务器交互中角色和信息的交换。通常情况下，请求--应答通信是同步的，在来自服务端的应答到达之前客户端进程是阻塞的，他也是可靠的，因为从服务器端的应答是对客户端进程的一个有效确认。

-   请求-应答协议
-   消息标识符
-   请求-应答协议的故障模型
-   超时
-   丢弃重复的请求信息
-   丢失应答消息
-   历史
-   交互协议的类型
-   请求-应答协议的TCP流的使用
-   HTTP：请求--应答协议的例子

### 远程过程调用

远程过程调用(RPC)使分布式编程和传统编程相似，即实现了高级的分布透明性。

在RPC中调用远程机器上的程序就像这些程序在本地的地址空间中一样。底层RPC系统隐藏了分布式环境重要的部分，包括对参数和结果的编码和解码、消息传递以及保留过程调用要求的语义。

-   RPC的设计问题
    -   接口编程
    -   RPC调用语义
    -   透明性
-   RPC的实现
-   实例研究：Sun RPC
    -   接口定义语言
    -   绑定
    -   认证

### 远程方法调用

远程方法调用(RMI)和RPC有紧密的联系，只是RMI被扩展到了分布式对象的范畴。

在RMI中，访问对象能够调用位于潜在的远程对象上的方法。

-   RMI的设计问题
    -   对象模型
    -   异常
    -   无用单元收集
    -   分布式对象
    -   分布式对象模型
    -   远程对象引用
    -   远程接口
    -   分布式对象系统中的动作
-   RMI的实现
    -   通信模块
    -   远程引用模块
    -   伺服器
    -   RMI软件
    -   创建代理、分类器和骨架类
    -   服务器和客户程序
    -   绑定程序
    -   服务器线程
    -   远程对象的激活
    -   持久对象存储
    -   对象定位
-   分布式无用单元收集


### 实例研究：Java RMI

Java RMI 扩展了Java的对象模型，以便为Java语言中的分布式对象提供支持。特别是，他允许对象用与本地调用相同的语法调用远程对象上的方法。

-   创建客户和服务器程序
    -   服务器程序
    -   客户程序
    -   回调
-   Java RMI的设计和实现
    -   反射的使用
    -   支持RMI的Java类

##  间接通信

间接通信的本质是通过一个中介者通信，就不存在发送者和一个或多个接收者之间的直接耦合。

-   组通信：在组通信中，通信通过一个抽象的组进行，发送者并不知道接收者的身份
-   发布-订阅系统：代表一类方法，这类方法的共同特点是通过中介者将事件分发给多个接收者
-   消息队列系统：其中消息发送到队列中，接收者从这些队列中提取消息
-   基于共享内存的方法：包括分布式共享内存和元组空间两种方法。

### 简介

间接通信被定义为在分布式系统中实体通过中介者进行通信，没有发送者和接收者之间的直接耦合。

中介者两个主要特征：
-   空间解耦：发送者不知道也不需要知道接收者的身份，反之亦然。
-   时间解耦：发送者和接收者可以有独立的生命周期。

### 组通信

组通信提供一种服务，在这种服务中，消息首先被发送到组中，然后该消息被传送到组中的所有成员。在这个动作中，发送者不清楚接收者的身份。

组通信是对组播通信的抽象，可以通过AIP组播或一个等价的覆盖网络实现，他增加了一些重要的特征，如管理组的成员、检查故障、提供可靠性和排序保证。

-   编程模型
    -   进程组合对象组
-   实现问题
    -   在组播中的可靠性和排序
    -   组成员管理
-   实例研究：JGroups 工具箱
    -   渠道
    -   构造块
    -   协议栈

### 发布-订阅系统

发布-订阅系统有时也称为基于事件的分布式系统。

在发布-订阅系统中，发布者发布结构化的事件到事件服务，订阅者通过订阅表达对特定事件感兴趣，其中订阅可以是结构化事件之上的任意模式。

一个给定的事件将被传递到许多潜在的订阅者，因此，发布--订阅本质上是一对多的通信泛型。

-   发布--订阅系统的特征
    -   异构性：当事件通知被用作一种通信手段时，分布式系统中没有被设计实现互操作的组件可以在一起工作。需要的只是生成事件的对象发布他们提供的事件的类型，其他对象订阅事件模式，并提供一个用于接收和处理结果通知的接口
    -   异步性：通知是由生成事件的发布者异步地发送到所有对其感兴趣的订阅者的，防止发布者需要与订阅者同步--发布者和订阅者需要解耦
-   编程模型：发布--订阅系统的编程模型是基于一个小的操作集。发布者通过publish(e)操作分发事件e，订阅者通过订阅表明对某事件集感兴趣
    -   基于渠道
    -   基于主题
    -   基于内容
    -   基于类型
-   实现问题：保证所有事件被有效地传递到有过滤器与事件匹配的所有订阅者
    -   有安全性、可伸缩性、故障处理、并发和服务质量等额外需求
    -   集中式实现与分布式实现
    -   总的系统体系结构

### 消息队列

消息队列使用队列概念作为一种间接机制提供点对点的服务，从而实现所期望的时间和空间解耦性质。

消息队列也称为面向消息的中间件。

-   编程模型
    -   阻塞接收
    -   非阻塞接收
    -   通知操作
-   实现问题
-   实例研究：Java 消息服务

### 共享内存的方式

分布式共享内存在读和写字节级别操作，可以通过地址进行访问。

-   分布式共享内存(DSM)

DSM是一种抽象，用于给不共享物理内存的计算机共享数据。进程通过读和更新看上去是其地址空间中普通的内存来访问DSM，然而，底层的运行时系统透明的保证运行在不同的计算机上的进程可以观察到其他进程的更新。就好像进程在访问单个共享内存，但是事实上物理内存是分布式的。

DSM是一种重要工具，用于并行应用、任何分布式应用或者一组应用(其中的每个应用都能直接访问单个共享数据项)

-   元组空间通信

在这种方法中，进程通过在元组空间放置元组间接的进行通信，其他进程可以从该元组空间读或删除元组。

元组没有地址，但是可以通过内容上的模式匹配进行访问。


##  操作系统支持

操作系统设施是怎样支持中间件的。操作系统促进了服务器内资源的封装和保护，同时他还支持用于访问这些资源的机制，包括通信和调度。

### 简介

共享资源是分布式系统地一个重要方面。客户应用程序所调用的资源经常在另一结点上或至少在另一进程上。应用程序(以客户的形式出现)和服务(以资源管理者的形式出现)使用中间件来进行交互。

中间件提供了分布式系统的各结点中对象或进程间的远程通信。

在中间件层下面是操作系统(OS)层。

任何一个操作系统地任务都是提供一个在物理层(处理器、内存、通信设备和存储介质)之上的面向问题的抽象。操作系统接管单个节点的物理资源并通过系统调用接口管理他们从而给出这些资源的抽象。

中间件和网络操作系统(UNIX、MacOS和Windows)的结合为自治性需求和网络透明的资源访问之间提供了一个可以接受的平衡。

网络操作系统使用用户能运行他们喜爱的字处理程序和其他独立运行的程序，中间件使他们能享受到分布式系统所提供的服务。

### 操作系统层

中间件将本地操作系统资源联合起来以实现在不同节点的对象和进程之间提供远程调用的机制。

中间件抽象、整合了结点资源，提供透明的服务。

-   内核和服务器进程用于管理资源和为客户提供资源接口，具备以下特点：
    -   封装：提供有用的能够访问资源的服务接口
    -   保护：资源需要被保护以防止非法访问
    -   并发处理：客户可以共享资源并能并发的访问他们
-   核心操作系统组件和他们的责任是：
    -   进程管理器：负责进程的创建和操作，进程包括一个地址空间以及一个或多个线程，是资源管理单元
    -   线程管理器：负责线程创建、同步和调度
    -   通信管理器：负责同一台计算机上不同进程中的线程之间的通信
    -   内存管理器：负责管理物理内存和虚拟内存
    -   管理器：负责处理中断、系统调用陷阱和其他异常，同时控制内存管理单元和硬件缓存以及处理器和浮点寄存器操作

### 保护

内核通过建立地址空间来保护自己和其他进程以防止异常进程的访问，同时也为正常进程提供他们所需的虚拟内存。

保护机制使程序执行会产生额外的开销，在地址空间之间切换会占用处理器的许多处理周期，并且系统调用陷阱也要比简单的过程调用或方法调用耗费更多的处理器资源。

### 进程和线程

一个进程是由一个执行环境和一个或多个线程组合成的。一个线程是一个活动的操作系统抽象。

执行环境是资源管理的基本单位，它是一个进程的线程所能访问的由本地内核管理的资源集。

-   地址空间

地址空间是管理一个进程虚拟内存的单元，它可以很大，由一个或多个区域组成，这些区域被不可访问的虚拟内存区隔开。

-   新进程的生成

一般而言，新进程的创建是由操作系统提供的一个不可分割的操作。

在分布式系统中，新进程的创建过程可以被划分为两个独立的方面：选择目标主机和创建执行环境

-   线程

使客户和服务器进程拥有多个线程带来的好处。

### 通信和调用

是中间件而不是内核提供了当今系统中的大多数高层通信方式，包括RPC/RMI、事件通信和组通信。

开发者在提供对互联网标准协议访问的套接字上实现中间件---经常使用有连接的TCP协议，有时也使用无连接的UDP协议。

-   调用性能

在分布式系统设计中，调用性能是一个非常关键的因素。

调用开销：除了是否异步，对调用机制的性能影响最大的是否涉及域转换、它是否涉及网络上通信，以及它是否涉及线程调度和切换。

在网络上调用：网络接口和主存之间的传输通常是由直接内存访问来处理的，其他拷贝则是由处理器处理的。

协议的选择：在像TCP这样的协议之上实现请求--应答交互必须要小心，因为这些协议并不是专为此目的而设计的。

-   异步操作

异步操作是应付高延迟的一种常用技术，他在两种编程模型中出现：并发调用和异步调用。这些模型主要出现在中间件领域，而不是出现在操作系统内存设计中。

使调用并发执行：中间件只提供阻塞型调用，但应用程序产生多个线程来并发执行阻塞型调用

异步调用：异步调用是对调用者调用的一次异步执行，也就是说，调用者进行的是非阻塞调用，只要创建了调用请求信息并准备发送，调用便结束了。

持久异步调用：试图无限的执行调用，直到他直到调用成功或失败，或者应用程序取消调用为止。

### 操作系统地体系结构

从资源管理策略中分离固定的资源管理机制已经在很长一段时间内成为操作系统设计的指导原则。

理想情况下，内核应该只提供一个在结点上实现通用资源管理任务的最基本机制。服务器模块应按需动态加载，以便为当前运行的应用实现所需的资源管理。

内核设计有两个主要例子：整体内核方法和微内核方法。

### 操作系统层的虚拟化

虚拟化是分布式系统中的一个重要概念。

-   系统虚拟化

系统虚拟化的目标是在底层物理机器体系结构之上提供多个虚拟机(虚拟硬件映像)，每个虚拟机运行一个独立的操作系统实例。

-   实例研究：系统虚拟化的Xen方法

Xen是系统虚拟化的成功典范。

----

# 第18章：群雄逐鹿下的Java事务管理


对于应用程序开发人员来说，更多的时候，只是通过相应产品提供的API接口来访问事务资源，并考虑如何在应用的业务逻辑中界定事务边界。

##  1、Java平台的局部事务支持

在Java的局部事务场景中，系统里事务管理的具体处理方式，是通过当前使用的数据访问技术所提供的基于`connection`的API来管理事务。

- 数据库资源的局部事务管理

JDBC是Java平台访问关系数据库最基础的API。

- 消息服务资源的局部事务管理

在使用JMS进行消息处理的过程中，通过JMS的javax.jms.Session来控制整个处理过程的事务。

##  2、Java平台的分布式事务支持

Java平台上的分布式事务管理，主要通过JTA或者JCA提供支持。

1.  基于JTA的分布式事务管理

JTA规范定义的只是一套Java接口定义，具体的实现留给了相应的提供商去实现，各Java EE应用服务器需要提供对JTA的支持。

- 实现产品
  - JOTM
  - Atomikos
  - JBoss Transactions

2.  基于JCA的分布式事务管理

JCA规范主要面向EIS的集成。

##  3、继续前行之前的反思

1.  局部事务的管理绑定到了具体的数据访问方式

事务管理代码与数据访问代码甚至业务逻辑代码相互混杂。

各种数据访问方式只提供了简单的事务API，但没有更高层次的抽象来帮助我们隔离事务与数据访问两个方面的过紧耦合。

2.  事务的异常处理

事务处理过程中出现的异常应该都是不可恢复的，应该抛出unchecked exception，但是现在的情况是：

- 没有一个统一的事务相关异常体系，使用特定API管理事务的时候，需要捕捉这些API特定的异常并进行处理
- 许多事务管理代码在使用过程中抛出的依然还是checked exception，这强制客户端代码来捕捉并处理他

3.  事务处理API的多样性

对开发人员来说，对事务的管理最多界定一下事务的边界，规定事务在什么地方开始，在什么地方结束。

没有一个统一的方式来抽象单一的事务管理需求，反而让这多种选择的优势变得繁杂而不易管理。

4.  CMT声明式事务的局限

EJB容器提供的CMT特性是比较受欢迎的事务界定管理方式，因为业务对象中不需要混杂任何事务管理的相关代码。

但CMT形式的声明式事务必须借助于EJB容器才能得到这样的好处。

----
